---
// src/pages/categories/[slug].astro
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import PostCard from '../../components/PostCard.astro';
import { getAllCategories, getCategoryBySlug, getPostsByCategory } from '../../../lib/cosmic';
import type { Category, Post } from '../../../types';

export async function getStaticPaths() {
  const categories = await getAllCategories();
  // Changed: Added type annotation for category parameter
  return categories.map((category: any) => ({
    params: { slug: category.slug },
  }));
}

const { slug } = Astro.params;
const category = await getCategoryBySlug(slug) as Category | null;

if (!category) {
  return Astro.redirect('/404');
}

const posts = await getPostsByCategory(category.id) as Post[];
---

<Layout 
  title={`${category.title} - Modern Blog`}
  description={category.metadata?.description || `Browse ${category.title} posts on Modern Blog`}
>
  <Header />
  
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">{category.title}</h1>
      {category.metadata?.description && (
        <p class="text-xl text-gray-600">{category.metadata.description}</p>
      )}
      <p class="text-gray-600 mt-2">
        {posts.length} {posts.length === 1 ? 'post' : 'posts'}
      </p>
    </div>
    
    {posts && posts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {posts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    ) : (
      <div class="text-center py-12">
        <p class="text-gray-600 text-lg">No posts found in this category yet.</p>
      </div>
    )}
  </main>
  
  <Footer />
</Layout>